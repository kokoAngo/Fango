/**
 * REINS 地区选择映射
 * 入力ガイドの多段選択構造に対応
 *
 * 選択フロー: 地方 → 都道府県 → 次へ → 地域区分 → 市区町村 → 次へ
 */

const AREA_MAPPING = {
  // 地方（第1段階）
  regions: {
    '東日本': ['北海道', '青森県', '岩手県', '宮城県', '秋田県', '山形県', '福島県',
               '茨城県', '栃木県', '群馬県', '埼玉県', '千葉県', '東京都', '神奈川県',
               '新潟県', '富山県', '石川県', '福井県', '山梨県', '長野県', '静岡県'],
    '西日本': ['岐阜県', '愛知県', '三重県', '滋賀県', '京都府', '大阪府', '兵庫県',
               '奈良県', '和歌山県', '鳥取県', '島根県', '岡山県', '広島県', '山口県',
               '徳島県', '香川県', '愛媛県', '高知県', '福岡県', '佐賀県', '長崎県',
               '熊本県', '大分県', '宮崎県', '鹿児島県', '沖縄県']
  },

  // 都道府県 → 地方の逆引き
  prefectureToRegion: {
    '東京都': '東日本',
    '神奈川県': '東日本',
    '埼玉県': '東日本',
    '千葉県': '東日本',
    '大阪府': '西日本',
    '京都府': '西日本',
    '兵庫県': '西日本',
    '愛知県': '西日本',
    '福岡県': '西日本',
    '北海道': '東日本',
    '宮城県': '東日本'
  },

  // 都道府県 → 地域区分
  prefectureAreas: {
    '東京都': {
      '23区': [
        '千代田区', '中央区', '港区', '新宿区', '文京区', '台東区', '墨田区', '江東区',
        '品川区', '目黒区', '大田区', '世田谷区', '渋谷区', '中野区', '杉並区', '豊島区',
        '北区', '荒川区', '板橋区', '練馬区', '足立区', '葛飾区', '江戸川区'
      ],
      '市部': [
        '八王子市', '立川市', '武蔵野市', '三鷹市', '青梅市', '府中市', '昭島市', '調布市',
        '町田市', '小金井市', '小平市', '日野市', '東村山市', '国分寺市', '国立市', '福生市',
        '狛江市', '東大和市', '清瀬市', '東久留米市', '武蔵村山市', '多摩市', '稲城市',
        '羽村市', 'あきる野市', '西東京市'
      ]
    },
    '神奈川県': {
      '横浜市': [
        '鶴見区', '神奈川区', '西区', '中区', '南区', '保土ケ谷区', '磯子区', '金沢区',
        '港北区', '戸塚区', '港南区', '旭区', '緑区', '瀬谷区', '栄区', '泉区', '青葉区', '都筑区'
      ],
      '川崎市': [
        '川崎区', '幸区', '中原区', '高津区', '多摩区', '宮前区', '麻生区'
      ],
      'その他': [
        '相模原市', '横須賀市', '平塚市', '鎌倉市', '藤沢市', '小田原市', '茅ヶ崎市',
        '逗子市', '三浦市', '秦野市', '厚木市', '大和市', '伊勢原市', '海老名市',
        '座間市', '南足柄市', '綾瀬市'
      ]
    },
    '大阪府': {
      '大阪市': [
        '都島区', '福島区', '此花区', '西区', '港区', '大正区', '天王寺区', '浪速区',
        '西淀川区', '東淀川区', '東成区', '生野区', '旭区', '城東区', '阿倍野区', '住吉区',
        '東住吉区', '西成区', '淀川区', '鶴見区', '住之江区', '平野区', '北区', '中央区'
      ],
      '堺市': [
        '堺区', '中区', '東区', '西区', '南区', '北区', '美原区'
      ],
      'その他': [
        '岸和田市', '豊中市', '池田市', '吹田市', '泉大津市', '高槻市', '貝塚市',
        '守口市', '枚方市', '茨木市', '八尾市', '泉佐野市', '富田林市', '寝屋川市',
        '河内長野市', '松原市', '大東市', '和泉市', '箕面市', '柏原市', '羽曳野市',
        '門真市', '摂津市', '高石市', '藤井寺市', '東大阪市', '泉南市', '四條畷市',
        '交野市', '大阪狭山市', '阪南市'
      ]
    }
  },

  // 市区町村 → 地域区分の逆引き（東京都）
  tokyo23ToArea: {
    '千代田区': '23区', '中央区': '23区', '港区': '23区', '新宿区': '23区',
    '文京区': '23区', '台東区': '23区', '墨田区': '23区', '江東区': '23区',
    '品川区': '23区', '目黒区': '23区', '大田区': '23区', '世田谷区': '23区',
    '渋谷区': '23区', '中野区': '23区', '杉並区': '23区', '豊島区': '23区',
    '北区': '23区', '荒川区': '23区', '板橋区': '23区', '練馬区': '23区',
    '足立区': '23区', '葛飾区': '23区', '江戸川区': '23区'
  }
};

/**
 * 選択パスを取得
 * @param {string} prefecture - 都道府県名（例：東京都）
 * @param {string} city - 市区町村名（例：渋谷区）
 * @returns {object} 選択パス
 */
function getSelectionPath(prefecture, city) {
  const path = {
    region: null,      // 地方（東日本/西日本）
    prefecture: prefecture,
    areaCategory: null, // 地域区分（23区、市部など）
    city: city
  };

  // 地方を取得
  path.region = AREA_MAPPING.prefectureToRegion[prefecture] || '東日本';

  // 地域区分を取得
  if (prefecture === '東京都' && city) {
    path.areaCategory = AREA_MAPPING.tokyo23ToArea[city] || '市部';
  } else if (prefecture === '神奈川県' && city) {
    if (city.includes('横浜')) {
      path.areaCategory = '横浜市';
    } else if (city.includes('川崎')) {
      path.areaCategory = '川崎市';
    } else {
      path.areaCategory = 'その他';
    }
  } else if (prefecture === '大阪府' && city) {
    if (city.includes('大阪市') || AREA_MAPPING.prefectureAreas['大阪府']['大阪市'].includes(city)) {
      path.areaCategory = '大阪市';
    } else if (city.includes('堺')) {
      path.areaCategory = '堺市';
    } else {
      path.areaCategory = 'その他';
    }
  }

  return path;
}

/**
 * 都道府県名を正規化
 */
function normalizePrefecture(name) {
  const aliases = {
    '東京': '東京都',
    '大阪': '大阪府',
    '京都': '京都府',
    '北海道': '北海道',
    '神奈川': '神奈川県',
    '埼玉': '埼玉県',
    '千葉': '千葉県',
    '愛知': '愛知県',
    '福岡': '福岡県',
    '兵庫': '兵庫県'
  };
  return aliases[name] || name;
}

module.exports = {
  AREA_MAPPING,
  getSelectionPath,
  normalizePrefecture
};
